<h1 align="center">Frodo</h1>

----

<p align="center"> <img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExNnVtaHp3ZmhqaWVtc2dzNTR1aHJ6MmdqYTFqb3MzcDlzOHRnODB0ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/pzqEdzCFRgGI0/giphy.gif" width="400" height=230" /> </p>

>Frodo was a hobbit of the Third Age, the most famous of all hobbits in history due to his principal role in the Quest of the Ring. During this epic journey, he bore the One Ring to Mount Doom and there destroyed it, granting him renown like no other halfling in all of Middle-earth.

# What is it?
Frodo is part of the [Delivery Platform](https://nubank.atlassian.net/wiki/spaces/CARDDELVPLAT/overview?homepageId=262896944959) and its responsible for

---

# What problem(s) does it strive to solve?

Before the Income report layout management was divided into two PDF Between the Nu and Nu invest stacks. Generated by two services called <a href= "https://github.com/nubank/mufasa">Mufasa nubank</a> and <a href= "https://github.com/nubank/nuinvest-mufasa"> NuInvest-Mufasa</a>. Both with a simpler layout. The layout of the Income report PDF was updated and with that the lib previously used would not support the new layout. R2-D2 comes with the objective of solving the new layouts of the pdf generation of the next years with the use of the <a href= "https://github.com/clj-pdf/clj-pdf">lib clj-pdf</a>.

---

# Core abstractions
The PDF generation microservice (R2-D2), will consume kafta message, and will generate the PDF template according to the year. After generating the pdf, it will save the generated file in S3 and in the end it will produce a kafka message with the path of the income report.

---



# Primary operations
- Consumer in the kafka create_tax_pdf queue
- Generate the Income Report file in format pdf.
- Save the file on S3
- Produce in the kafka tax_pdf_created queue the file path in the bucket S3.

---


# Architectural Components
<p align="center"><img src="./doc/img/architectural_components.png"/></p>

---


# Is it simple?
R2-D2 is a microservice created for the PDF according to the information passed by the <a href= "https://github.com/nubank/galactic-republic"> Galactic Republic </a> microservice through kafta messages, and save the generated PDF in S3.

---


# Key indicators for use are:
- Service with the unique responsibility of generating and saving the income report in PDF format.
- Service Architecture does not connect to databases.
- Template versioning by year.
- from calendar year 2022.

---


# Key indicators against use:
 - It does not generate income reports for years prior to calendar year 2022.

---
# Resources

[Integration documentation](https://nubank.atlassian.net/wiki/spaces/BIDT/pages/262849265921/Income+Tax+Report+-+Digital+Tax)

[RFC](https://docs.google.com/document/d/1XsQ6V8VM_hwmCUQKFQNimg8BRAcmwCGjDzIIJlDEWbI/edit#)

[Playbook](https://playbooks.nubank.com.br/tribe/Investments/Digital%20Tax/Income%20Report/r2-d2/)

[Grafana Dashboard](https://prod-grafana.ist.nubank.world/login)

[Splunk Dashboard](https://nubank.splunkcloud.com/en-US/app/search/digital_tax_r2d2?form.field1.earliest=-60m%40m&form.field1.latest=now&form.span.earliest=-4h%40m&form.span.latest=now&form.span=2d&form.field1=1h&form.timeline.earliest=-7d%40h&form.timeline.latest=now)

[Team Slack channel](https://nubank.slack.com/archives/C03HXPBM11T)


# Development Practices and Environmental Setup
## Generic Components v2022
Generic components were created to make PDF V2022 construction faster and reusable. To use it require namespace r2-d2.adapters.templates.v2022.components.factory-generic-components.
###  G.TITLE
<p align="left"><img src="./doc/img/g-title.png"/></p>

### G.CODE-GROUP-DESCRIPTION
<p align="left"><img src="./doc/img/g-code-group-description.png"/></p>

### G.DISCLAIMER
<p align="left"><img src="./doc/img/g-disclaimer.png"/></p>

### G.TABLE
<p align="left"><img src="./doc/img/g-table.png"/></p>

### G.BANNER
<p align="left"><img src="./doc/img/g-banner.png"/></p>


---

## Code Style

* Check our [Clojure Code Style Best Practices Recommendations](https://github.com/nubank/playbooks/blob/master/docs/clojure/code-style.md)


---

## Linting

### List issues

```
lein lint
```
### Add that git comment, to fix lint
```
cicd/lint-fix
```

### Fix issues

```
lein lint-fix
```

---

## Testing

Run all tests:
```bash
$ lein test
```

Run autotest (make sure you have `[com.jakemccrary/lein-test-refresh "0.24.1"]` set as a lein plugin)

```bash
$ lein test-refresh :changes-only
```

### Unit tests

```
$ lein unit
```

### Integration tests

```
$ lein integration
```
